<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>APHELION</title>
    <style>
    </style>
    <script src="v2/libMenu.js" type="text/javascript"></script>
    <script src="v2/libEngine.js" type="text/javascript"></script>
    <script src="v2/libWeapon.js" type="text/javascript"></script>
    <script src="v2/libProjectile.js" type="text/javascript"></script>
    <script src="v2/libCursor.js" type="text/javascript"></script>
    <script src="v2/libBackground.js" type="text/javascript"></script>
    <script src="v2/libIa.js" type="text/javascript"></script>
    <script src="v2/libPasserby.js" type="text/javascript"></script>
    <script>
      function InputListener() {
        this.mouseX;
        this.mouseY;
        this.mouseHasClicked;
        this.mouseHasRealeased;
      }
      var inputListener = new InputListener();
      function init() {
        document.getElementById("maindiv").addEventListener('mousemove', function(evt) {
          inputListener.mouseX = evt.offsetX;
          inputListener.mouseY = evt.offsetY;
        }, true);
        document.getElementById("maindiv").addEventListener('mouseup', function(evt) {
          inputListener.mouseHasRealeased = new Date();
          inputListener.mouseHasClicked = null;
        }, true);
        document.getElementById("maindiv").addEventListener('mousedown', function(evt) {
          inputListener.mouseHasClicked = new Date();
          inputListener.mouseHasRealeased = null;
        }, true);
        document.getElementById("maindiv").appendChild(viewportDiv);
        viewportDiv.appendChild(CANVAS_BACKGROUND);
        viewportDiv.appendChild(CANVAS_FOREGROUND);
        viewportDiv.appendChild(CANVAS_HEADUP);
        viewportDiv.appendChild(CANVAS_MENU);
        animate();
      }
    </script>
    <script>
      var cursor = new Cursor();
      var background = new Background();
      function MainLoop() {
        this.button = [];
        this.draw = function draw() {
          CANVAS_MENU.getContext('2d').clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
          this.button.forEach(function draw(b) { b.draw() });

          // Manage Logic
          cursor.update();
          background.update();
          passerbyFactory.update();
          projectileFactory.update();
          quadTree.update();
          // Manage Display
          cursor.draw();
          background.draw();
          passerbyFactory.draw();
          projectileFactory.draw();
          //DEBUG
          quadTree.draw();
        }
      }
      var menu4 = new MainLoop();
    </script>
    <script>
      var screenStack = [];

      var menu1 = new Menu();
      var menu2 = new Menu();
      var menu3 = new Menu();
      var button_1_1 = new Button("To Menu 2", 50, 50, 100, 30, function toMenu2() { screenStack.unshift(menu2); });
      menu1.button.push(button_1_1);
      var button_1_2 = new Button("To Menu 3", 450, 50, 100, 30, function toMenu3() { screenStack.unshift(menu3); });
      menu1.button.push(button_1_2);
      var button_1_3 = new Button("To Menu 4", 250, 250, 100, 30, function toMenu3() { screenStack.unshift(menu4); });
      menu1.button.push(button_1_3);
      var button_2_back = new Button("To Menu 1", 50, 50, 100, 30, function toMenu2() { screenStack.shift(); });
      menu2.button.push(button_2_back);
      var button_3_back = new Button("To Menu 1", 450, 50, 100, 30, function toMenu2() { screenStack.shift(); });
      menu3.button.push(button_3_back);
      screenStack.unshift(menu1);

      function animate() {

       screenStack[0].draw();
     	 requestAnimFrame( animate );
     }
     /**
      * requestAnim shim layer by Paul Irish
      * Finds the first API that works to optimize the animation loop,
      * otherwise defaults to setTimeout().
      */
     window.requestAnimFrame = (function(){
     	return  window.requestAnimationFrame   ||
     			window.webkitRequestAnimationFrame ||
     			window.mozRequestAnimationFrame    ||
     			window.oRequestAnimationFrame      ||
     			window.msRequestAnimationFrame     ||
     			function(/* function */ callback, /* DOMElement */ element){
     				window.setTimeout(callback, 1000 / 60);
     			};
     })();
    </script>
  </head>
    <body onload="init()">
     <div id="maindiv" style="overflow: auto">
     </div>
  </body>
</html>
